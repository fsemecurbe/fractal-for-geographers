<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>index</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap-17f98f3e874d5462cd427c278c7f8337.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="index_files/libs/quarto-contrib/intersection-observer-polyfill-1.0.0/intersection-observer.js"></script>
<script src="index_files/libs/quarto-contrib/scrollama-3.2.0/scrollama.min.js"></script>
<script src="index_files/libs/quarto-contrib/closeread-0.1.0/closeread.js"></script>
<script type="module" src="index_files/libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="index_files/libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<meta cr-debug-mode="false">
<meta cr-remove-header-space="true">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="_extensions/qmd-lab/closeread/closeread.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full">

<main class="content column-page" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>
      <!-- user-provided yaml closeread style options -->
      <style>
        :root {
          --cr-narrative-overlay-max-width: 70%;
--cr-narrative-border-radius: 5px;
--cr-narrative-text-color-overlay: #FFFDD0;
--cr-narrative-background-color-sidebar: #A9A9A9;
--cr-narrative-font-size: 1.2rem;
--cr-narrative-text-color-sidebar: #ffffff;
--cr-narrative-background-color-overlay: #7393B3;
--cr-narrative-font-family: sans-serif;
--cr-section-background-color: #f9f9f2;
--cr-narrative-outer-margin: 10px;
        }
      </style>
    




<div class="custom-title">
<p>Beyond the Modifiable Areal Unit Problem!</p>
</div>
<section id="why-fractals-are-so-useful-for-geographers" class="level2">
<h2 class="anchored" data-anchor-id="why-fractals-are-so-useful-for-geographers">Why fractals are so useful for Geographers?</h2>
<p>In the early eighties, fractals were everywhere, from the shape of clouds to the spatial organisation of galaxies. Now, scientists are more nuanced. Fractal is still a very important area of research, but there is no need for the world to be fractal in order to use fractal analysis.</p>
<p>Before we discuss the usefulness of fractals for geographers, it might be relevant to introduce them. Fractals were invented - discovered - by Beno√Æt Mandelbrot, a French-American mathematician who believed that the world was not smooth, but rough. No matter how you look at it, every part of an object looks like the whole object. This is one way to describe what a fractal is. Another way is to say that a fractal has lots of detail at each scale. The two points of view are not opposite, as we can see.</p>
<div class="cr-section cr-column-screen overlay-center">
<div class="narrative-col">
<div class="trigger">
<div class="narrative">
<div class="cr-spacer" style="padding-block: 5.0svh;">

</div>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-map">
<div class="narrative">
<p>This the picture of a simple fractal. This could well be a representation of a density map of population. The gradient colour scheme is showing the intensity of the density : <span style="color:#a50026;">higher values</span> and <span style="color:#cce88b;">lower values</span></p>
</div>
</div>
<div class="trigger new-trigger" data-scale-by="3" data-pan-to="0%,10%" data-focus-on="cr-map">
<div class="narrative">
<p>If we look closely at one part, we see the same pattern.</p>
</div>
</div>
<div class="trigger new-trigger" data-scale-by="9" data-pan-to="0%, 10%" data-focus-on="cr-map">
<div class="narrative">
<p>we can still go deeper, and we still find out the same pattern of details.</p>
</div>
</div>
<div class="trigger new-trigger" data-scale-by="27" data-pan-to="0%,20%" data-focus-on="cr-map">
<div class="narrative">
<p>When it comes to theoretical fractals, we can go deeper and deeper. But in practice, there is a minimum scale.</p>
</div>
</div>
<div class="trigger new-trigger" data-scale-by="27" data-pan-to="0%,20%" data-focus-on="cr-map">
<div class="narrative">
<p>For example, a city is made up of buildings. A building is the smallest part of a city. Inside a building, it‚Äôs a whole different world.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-map">
<div class="narrative">
<p>At each scale, the details are arranged in the same way. This is the most important property of the fractal: their scale are bound together with specific ties.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-map">
<div class="narrative">
<p>In our example, the link is obvious and it appears when the fractal is being constructed.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-map2">
<div class="narrative">
<p>To build our fractal, we need a generator a grid and a way to distribute the population in the space : P<sub>i</sub> is a probability distribution. Their sum is 1.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-map2">
<div class="narrative">
<p>The side of each cell is 1/3.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-map2">
<div class="narrative">
<p>In your example P<sub>5</sub>=1/2 and the other P<sub>1</sub>=P<sub>2</sub>‚Ä¶=P<sub>8</sub>=P<sub>9</sub>=1/12.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-map2">
<div class="narrative">
<p>In other words, half of the population is concentrated in the cell 5.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-map3">
<div class="narrative">
<p>The first step is to decompose each cell with the generator.</p>
</div>
</div>
<div class="trigger new-trigger" data-scale-by="3" data-pan-to="0%,0%" data-focus-on="cr-map3">
<div class="narrative">
<p>In each new cell, the population is P<sub>mother</sub>.P<sub>son</sub></p>
</div>
</div>
<div class="trigger new-trigger" data-scale-by="3" data-pan-to="0%,0%" data-focus-on="cr-map3">
<div class="narrative">
<p>The side of the cell is now (1/3)<sup>2</sup>.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-map4">
<div class="narrative">
<p>At this step, the representation of the fractal is vey simple.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-map5">
<div class="narrative">
<p>If we divide the fractal into smaller parts again, we can see much more detail. The side of the cell is (1/3)<sup>3</sup>.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-map6">
<div class="narrative">
<p>To get the fractal, we keep decomposing it until we can‚Äôt do it any more.</p>
</div>
</div>
</div>
<div class="sticky-col">
<div class="sticky-col-stack">
<div id="cr-map" class="sticky">
<p><img src="images/multifractal.svg" class="img-fluid" data-max-width="100;max-height=100"></p>
</div>
<div id="cr-map2" class="sticky">
<p><img src="images/multifractal1.svg" class="img-fluid"></p>
</div>
<div id="cr-map3" class="sticky">
<p><img src="images/multifractal2.svg" class="img-fluid"></p>
</div>
<div id="cr-map4" class="sticky">
<p><img src="images/multifractal3.svg" class="img-fluid"></p>
</div>
<div id="cr-map5" class="sticky">
<p><img src="images/multifractal4.svg" class="img-fluid"></p>
</div>
<div id="cr-map6" class="sticky">
<p><img src="images/multifractal5.svg" class="img-fluid"></p>
</div>
</div>
</div>
</div>
</section>
<section id="the-dimension-of-information" class="level2">
<h2 class="anchored" data-anchor-id="the-dimension-of-information">The dimension of information</h2>
<p>Fortunately, fractal theory isn‚Äôt just a way of making fancy pictures, it‚Äôs also a toolbox for measuring how the scales are related. Beno√Æt Mandelbrot uses fractal dimensions to do this. There are a plethora of fractal dimensions, from the very theoretical to the more practical uses in Physics.</p>
<p>In this article, we focus on a specific dimension called the information dimension. It is based on the Shannon entropy, which is the number of Boolean questions we have to ask to find an element in an ensemble.</p>
<div class="cr-section cr-column-screen overlay-center">
<div class="narrative-col">
<div class="trigger new-trigger" data-focus-on="cr-map7">
<div class="narrative">
<p>Imagine a situation where Santa Claus is located in cell from the generator. It‚Äôs probabity to be in a certain cell i is P<sub>i</sub>.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-map7">
<div class="narrative">
<p>Keep in mind that P<sub>i</sub>=1/2 and The other probabilities are equally distributed.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-map7">
<div class="narrative">
<p>How many questions do we ask to find him ?</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-map8">
<div class="narrative">
<p>The first legit question is : ‚ÄúIs Santa Claus üéÖ in the cell 5 ?‚Äù</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-map8b">
<div class="narrative">
<p>If this is true, the game is over, one question is enough.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-map9">
<div class="narrative">
<p>Otherwise, we divide the rest of the cells into two groups [1,2,3,4] and [6,7,8,9]</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-map9">
<div class="narrative">
<p>We then ask if Santa Claus üéÖ is in the first group [1,2,3,4].</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-map10">
<div class="narrative">
<p>If this is true, we have to divide the first group again into two groups ([1,2], [3,4]) and ask if Santa Claus is in [1,2].</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-map11">
<div class="narrative">
<p>If this is true, we have to ask if Santa Claus üéÖ is in cell 3.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-map11b">
<div class="narrative">
<p>Ok, the Santa Claus üéÖ is in cell 3.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-map11b">
<div class="narrative">
<p>In average, we have to wonder 1/2 * 1 + 1/2 * 3 = 2 questions to find Santa Claus üéÖ.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-map11b">
<div class="narrative">
<p>In our case, it was possible to use a dichtomic approach because all the probabilities are a power of 2.</p>
</div>
</div>
<div class="trigger new-trigger" data-scale-by="2" data-pan-to="0%,0%" data-focus-on="cr-limerick">
<div class="narrative">
<p>In general, Shanon‚Äôs entropy is used to estimate the number of dichotomous questions.</p>
</div>
</div>
<div class="trigger new-trigger" data-scale-by="2" data-pan-to="0%,0%" data-focus-on="cr-limerick">
<div class="narrative">
<p>At first glance, it doesn‚Äôt seem natural, at least for me. We will give it some interpretation.</p>
</div>
</div>
<div class="trigger new-trigger" data-highlight="cr-mean" data-scale-by="2" data-pan-to="0%,0%" data-focus-on="cr-limerick">
<div class="narrative">
<p>We can recognise an average in the first part.</p>
</div>
</div>
<div class="trigger new-trigger" data-highlight="cr-quant" data-scale-by="2" data-pan-to="0%,0%" data-focus-on="cr-limerick">
<div class="narrative">
<p>The second part is a bit more tricky.</p>
</div>
</div>
<div class="trigger new-trigger" data-highlight="cr-quant" data-scale-by="2" data-pan-to="0%,0%" data-focus-on="cr-limerick">
<div class="narrative">
<p>Logarithm is used to estimate the number of questions associated with the P<sub>i</sub>.</p>
</div>
</div>
<div class="trigger new-trigger" data-highlight="cr-quant" data-scale-by="2" data-pan-to="0%,0%" data-focus-on="cr-limerick">
<div class="narrative">
<p>In fact, the logarithm is the quantity of digits needed to write a number.</p>
</div>
</div>
<div class="trigger new-trigger" data-scale-by="2" data-pan-to="0%,0%" data-focus-on="cr-limerick">
<div class="narrative">
<p>So the entropy, is the average of question needed to find the Santa Claus.</p>
</div>
</div>
<div class="trigger new-trigger" data-scale-by="2" data-pan-to="0%,0%" data-focus-on="cr-limerick">
<div class="narrative">
<p>If we try to apply the formula to our example, we find 2 again.</p>
</div>
</div>
<div class="trigger new-trigger" data-scale-by="2" data-pan-to="0%,0%" data-focus-on="cr-limerick">
<div class="narrative">
<p>Okay, this is interesting, but what‚Äôs up with fractals?</p>
</div>
</div>
<div class="trigger new-trigger" data-scale-by="2" data-pan-to="0%,0%" data-focus-on="cr-limerick">
<div class="narrative">
<p>The information dimension is the number of additional questions that need to be asked to locate Santa Claus on a more precise scale. It is given by the Entropy of the generator.</p>
</div>
</div>
</div>
<div class="sticky-col">
<div class="sticky-col-stack">
<div id="cr-map7" class="sticky">
<p><img src="images/multifractal1a.svg" class="img-fluid"></p>
</div>
<div id="cr-map8" class="sticky">
<p><img src="images/multifractal1b2.svg" class="img-fluid"></p>
</div>
<div id="cr-map8b" class="sticky">
<p><img src="images/multifractal1b.svg" class="img-fluid"></p>
</div>
<div id="cr-map9" class="sticky">
<p><img src="images/multifractal1c.svg" class="img-fluid"></p>
</div>
<div id="cr-map10" class="sticky">
<p><img src="images/multifractal1d.svg" class="img-fluid"></p>
</div>
<div id="cr-map11" class="sticky">
<p><img src="images/multifractal1e.svg" class="img-fluid"></p>
</div>
<div id="cr-map11b" class="sticky">
<p><img src="images/multifractal1eb.svg" class="img-fluid"></p>
</div>
<div id="cr-limerick" class="scale-to-fill sticky">
<div class="line-block"><span id="lb1-1"><span id="cr-mean"><span class="math inline">\(H = - \sum_{i} p_i\)</span></span> <span id="cr-quant"><span class="math inline">\(\log_2 (p_i)\)</span></span></span></div>
</div>
</div>
</div>
</div>
</section>
<section id="and-what-about-geography" class="level2">
<h2 class="anchored" data-anchor-id="and-what-about-geography">And what about geography‚Ä¶</h2>
<p>In geography, the role of scale is a major concern. It has been theorized under the concept of the Modifiable Areal Unit Problem (MAUP). The resulting summary values (e.g., totals, rates, proportions, densities) are influenced by both the shape and scale of the aggregation unit.</p>
<div class="cr-section cr-column-screen overlay-center">
<div class="narrative-col">
<div class="trigger new-trigger" data-focus-on="cr-map12">
<div class="narrative">
<p>In this <a href="https://en.wikipedia.org/wiki/Modifiable_areal_unit_problem">example from Wikipedia</a>, we see a distribution of people and the distortion of rate calculations.</p>
</div>
</div>
<div class="trigger new-trigger" data-scale-by="2" data-pan-to="50%,-50%" data-focus-on="cr-map12">
<div class="narrative">
<p>In the Region Set A, there is two units, one with 0% of illness rate and the other with 50 %.</p>
</div>
</div>
<div class="trigger new-trigger" data-scale-by="2" data-pan-to="-50%,-50%" data-focus-on="cr-map12">
<div class="narrative">
<p>In the Region Set B, there is still two units, one unit have 0% of illness rate but the other with 100 %.</p>
</div>
</div>
<div class="trigger new-trigger" data-scale-by="1" data-pan-to="0%,0%" data-focus-on="cr-map12">
<div class="narrative">
<p>It‚Äôs not a theoretical trap. Unfortunately, the MAUP could influence how policy makers coordinate their actions at different scales, from local to regional to national. It is one of the reasons why we can‚Äôt manage climate change.</p>
</div>
</div>
</div>
<div class="sticky-col">
<div class="sticky-col-stack">
<div id="cr-map12" class="sticky">
<p><img src="images/Maup_rate_numbers.png" class="img-fluid"></p>
</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb1" data-startfrom="224" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 223;"><span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a>widthheight <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(width<span class="op">,</span> <span class="bu">window</span><span class="op">.</span><span class="at">innerHeight</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cr-section cr-column-screen overlay-center">
<div class="narrative-col">
<div class="progress-block">
<div class="trigger new-trigger" data-focus-on="cr-cartes">
<div class="narrative">
<p>One of the trickiest problems in geography is how to describe a spatial population, specialy in Mainland France.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-cartes">
<div class="narrative">
<p>The density of population depends of the scale.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-cartes">
<div class="narrative">
<p>At each scale there are high and low density places.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-cartes">
<div class="narrative">
<p>But the deeper we go into the scale, the greater the variability of the scale.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-cartes">
<div class="narrative">
<p>We end up with a map of Paris.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-cartes">
<div class="narrative">
<p>So, instead of focusing on specific good scales, it‚Äôs better to think that all space scales are equally important and that the important information is in the ways they‚Äôre connected to each other.</p>
</div>
</div>
</div>
</div>
<div class="sticky-col">
<div class="sticky-col-stack">
<div id="cr-cartes" class="sticky">
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb2" data-startfrom="256" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 255;"><span id="cb2-256"><a href="#cb2-256" aria-hidden="true" tabindex="-1"></a>chart <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb2-257"><a href="#cb2-257" aria-hidden="true" tabindex="-1"></a>  <span class="dt">projection</span><span class="op">:</span> projection<span class="op">,</span>  </span>
<span id="cb2-258"><a href="#cb2-258" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-259"><a href="#cb2-259" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> widthheight<span class="op">,</span></span>
<span id="cb2-260"><a href="#cb2-260" aria-hidden="true" tabindex="-1"></a>    <span class="dt">height</span><span class="op">:</span> widthheight<span class="op">,</span></span>
<span id="cb2-261"><a href="#cb2-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-262"><a href="#cb2-262" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb2-263"><a href="#cb2-263" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"quantile"</span><span class="op">,</span></span>
<span id="cb2-264"><a href="#cb2-264" aria-hidden="true" tabindex="-1"></a>    <span class="dt">n</span><span class="op">:</span> <span class="dv">9</span><span class="op">,</span></span>
<span id="cb2-265"><a href="#cb2-265" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scheme</span><span class="op">:</span> <span class="st">"RdYlGn"</span><span class="op">,</span></span>
<span id="cb2-266"><a href="#cb2-266" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Density of population"</span><span class="op">,</span></span>
<span id="cb2-267"><a href="#cb2-267" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb2-268"><a href="#cb2-268" aria-hidden="true" tabindex="-1"></a>    <span class="dt">reverse</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb2-269"><a href="#cb2-269" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb2-270"><a href="#cb2-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-271"><a href="#cb2-271" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb2-272"><a href="#cb2-272" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">geo</span>(data<span class="op">,</span> {<span class="dt">fill</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">ind</span>})<span class="op">,</span></span>
<span id="cb2-273"><a href="#cb2-273" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">geo</span>(dep<span class="op">,</span> { <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span> <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">5000</span><span class="op">/</span>(<span class="fl">0.5</span><span class="op">+</span>crTriggerIndex<span class="op">**</span><span class="dv">3</span> <span class="op">*.</span><span class="dv">5</span>) })<span class="op">,</span></span>
<span id="cb2-274"><a href="#cb2-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-275"><a href="#cb2-275" aria-hidden="true" tabindex="-1"></a>    <span class="op">,</span> <span class="kw">null</span></span>
<span id="cb2-276"><a href="#cb2-276" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb2-277"><a href="#cb2-277" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="cr-section cr-column-screen overlay-center">
<div class="narrative-col">
<div class="trigger new-trigger" data-scale-by="1" data-pan-to="0%,0%" data-focus-on="cr-map20">
<div class="narrative">
<p>In practice, there is no generator, it‚Äôs the reason why we use an estimation. We perform the entropy for different sides of the cells.</p>
</div>
</div>
<div class="trigger new-trigger" data-focus-on="cr-map20">
<div class="narrative">
<p>For example, we have computed the entropy around for four sides of cells [800m, 1600m, 3200m, 6400m]</p>
</div>
</div>
<div class="trigger new-trigger" data-scale-by="1" data-pan-to="0%,0%" data-focus-on="cr-map21">
<div class="narrative">
<p>The fractal dimension is the slope of the lesser squares regression line. It‚Äôs an estimation. In your case, Paris is not strictly fractal, because the points are not aligned. Nevertheless, the fractal dimension is always relevant and can be interpreted as the average marginal information across scales.</p>
</div>
</div>
<div class="trigger new-trigger" data-scale-by="1" data-pan-to="0%,0%" data-focus-on="cr-map22">
<div class="narrative">
<p>We have divided France in 25.6km side units and perform fractal analyis for each unit. The map displays the local fractal dimension of the population.</p>
</div>
</div>
<div class="trigger new-trigger" data-scale-by="1" data-pan-to="0%,0%" data-focus-on="cr-map22">
<div class="narrative">
<p>We measure the dispersed concentration of the population that density can reveal. So it is a fantastic tool for the regional planning to adapt the network to the population.</p>
</div>
</div>
</div>
<div class="sticky-col">
<div class="sticky-col-stack">
<div id="cr-map20" class="sticky">
<p><img src="images/sc.svg" class="img-fluid"></p>
</div>
<div id="cr-map21" class="sticky">
<p><img src="images/sc_reg.svg" class="img-fluid"></p>
</div>
<div id="cr-map22" class="sticky">
<p><img src="images/dimension.svg" class="img-fluid"></p>
</div>
</div>
</div>
</div>
<div class="cell hidden">
<div class="sourceCode cell-code hidden" id="cb3" data-startfrom="355" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 354;"><span id="cb3-355"><a href="#cb3-355" aria-hidden="true" tabindex="-1"></a>trans_x <span class="op">=</span> <span class="kw">function</span>(x) {<span class="cf">return</span> (x<span class="op">-</span> <span class="dv">3234242</span>)<span class="op">/</span><span class="dv">1200000</span><span class="op">*</span>width}<span class="op">;</span></span>
<span id="cb3-356"><a href="#cb3-356" aria-hidden="true" tabindex="-1"></a>trans_y <span class="op">=</span> <span class="kw">function</span>(y) {<span class="cf">return</span> (<span class="op">-</span>y<span class="op">+</span><span class="dv">2016044</span><span class="op">+</span><span class="dv">1200000</span>)<span class="op">/</span><span class="dv">1200000</span><span class="op">*</span>width}<span class="op">;</span></span>
<span id="cb3-357"><a href="#cb3-357" aria-hidden="true" tabindex="-1"></a>chart<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"viewBox"</span><span class="op">,</span> toto)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-3-3" data-nodetype="expression">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb4" data-startfrom="361" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 360;"><span id="cb4-361"><a href="#cb4-361" aria-hidden="true" tabindex="-1"></a>carreaux_1 <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"images/carreaux_20000.geojson"</span>)<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb4-362"><a href="#cb4-362" aria-hidden="true" tabindex="-1"></a>carreaux_2 <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"images/carreaux_5000.geojson"</span>)<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb4-363"><a href="#cb4-363" aria-hidden="true" tabindex="-1"></a>carreaux_3 <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"images/carreaux_1000.geojson"</span>)<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb4-364"><a href="#cb4-364" aria-hidden="true" tabindex="-1"></a>carreaux_4 <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"images/carreaux_200.geojson"</span>)<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb4-365"><a href="#cb4-365" aria-hidden="true" tabindex="-1"></a>dep <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"images/dep.geojson"</span>)<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-5" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell hidden">
<div class="sourceCode cell-code hidden" id="cb5" data-startfrom="369" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 368;"><span id="cb5-369"><a href="#cb5-369" aria-hidden="true" tabindex="-1"></a>projection <span class="op">=</span>     d3<span class="op">.</span><span class="fu">geoTransform</span>({<span class="dt">point</span><span class="op">:</span> <span class="kw">function</span>(x<span class="op">,</span> y) {<span class="kw">this</span><span class="op">.</span><span class="at">stream</span><span class="op">.</span><span class="fu">point</span>((x<span class="op">-</span> <span class="dv">3234242</span>)<span class="op">/</span><span class="dv">1200000</span><span class="op">*</span>width<span class="op">,</span>(<span class="op">-</span>y<span class="op">+</span><span class="dv">2016044</span><span class="op">+</span><span class="dv">1200000</span>)<span class="op">/</span><span class="dv">1200000</span><span class="op">*</span>width)<span class="op">;</span>  }</span>
<span id="cb5-370"><a href="#cb5-370" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell hidden">
<div class="sourceCode cell-code hidden" id="cb6" data-startfrom="375" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 374;"><span id="cb6-375"><a href="#cb6-375" aria-hidden="true" tabindex="-1"></a>progression <span class="op">=</span> </span>
<span id="cb6-376"><a href="#cb6-376" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb6-377"><a href="#cb6-377" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> {<span class="cf">return</span>  crProgressBlock}</span>
<span id="cb6-378"><a href="#cb6-378" aria-hidden="true" tabindex="-1"></a><span class="cf">catch</span> {<span class="cf">return</span> <span class="fl">0.99</span>}</span>
<span id="cb6-379"><a href="#cb6-379" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell hidden">
<div class="sourceCode cell-code hidden" id="cb7" data-startfrom="385" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 384;"><span id="cb7-385"><a href="#cb7-385" aria-hidden="true" tabindex="-1"></a>seuil <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> <span class="op">.</span><span class="dv">25</span><span class="op">,</span> <span class="op">.</span><span class="dv">5</span><span class="op">,</span> <span class="fl">0.75</span><span class="op">,</span>  <span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell hidden">
<div class="sourceCode cell-code hidden" id="cb8" data-startfrom="391" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 390;"><span id="cb8-391"><a href="#cb8-391" aria-hidden="true" tabindex="-1"></a>etape <span class="op">=</span> </span>
<span id="cb8-392"><a href="#cb8-392" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb8-393"><a href="#cb8-393" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> {<span class="cf">return</span> seuil<span class="op">.</span><span class="fu">findIndex</span>(num <span class="kw">=&gt;</span> num <span class="op">&gt;</span> progression)<span class="op">-</span><span class="dv">1</span><span class="op">;</span>}</span>
<span id="cb8-394"><a href="#cb8-394" aria-hidden="true" tabindex="-1"></a><span class="cf">catch</span> {<span class="cf">return</span> <span class="dv">3</span>}</span>
<span id="cb8-395"><a href="#cb8-395" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell hidden">
<div class="sourceCode cell-code hidden" id="cb9" data-startfrom="403" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 402;"><span id="cb9-403"><a href="#cb9-403" aria-hidden="true" tabindex="-1"></a>data_range <span class="op">=</span> [carreaux_1<span class="op">,</span> carreaux_2<span class="op">,</span> carreaux_3<span class="op">,</span> carreaux_4]</span>
<span id="cb9-404"><a href="#cb9-404" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data_range[etape]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-9-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-9-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell hidden">
<div class="sourceCode cell-code hidden" id="cb10" data-startfrom="409" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 408;"><span id="cb10-409"><a href="#cb10-409" aria-hidden="true" tabindex="-1"></a>seuil_range <span class="op">=</span> [seuil[etape]<span class="op">,</span> seuil[etape<span class="op">+</span><span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb11" data-startfrom="414" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 413;"><span id="cb11-414"><a href="#cb11-414" aria-hidden="true" tabindex="-1"></a>zoom1 <span class="op">=</span> <span class="dv">100000</span></span>
<span id="cb11-415"><a href="#cb11-415" aria-hidden="true" tabindex="-1"></a>zoom2 <span class="op">=</span> <span class="dv">20000</span></span>
<span id="cb11-416"><a href="#cb11-416" aria-hidden="true" tabindex="-1"></a>zoom3 <span class="op">=</span> <span class="dv">7000</span></span>
<span id="cb11-417"><a href="#cb11-417" aria-hidden="true" tabindex="-1"></a>zoom4 <span class="op">=</span> <span class="dv">7000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-11-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-11-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-11-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-11-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell hidden">
<div class="sourceCode cell-code hidden" id="cb12" data-startfrom="423" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 422;"><span id="cb12-423"><a href="#cb12-423" aria-hidden="true" tabindex="-1"></a>x_min_range <span class="op">=</span> [[<span class="dv">3234242</span><span class="op">,</span> <span class="dv">3760524</span><span class="op">-</span>zoom1]<span class="op">,</span> [<span class="dv">3760524</span><span class="op">-</span>zoom1<span class="op">,</span> <span class="dv">3760524</span><span class="op">-</span>zoom2]<span class="op">,</span> [<span class="dv">3760524</span><span class="op">-</span>zoom2<span class="op">,</span> <span class="dv">3760524</span><span class="op">-</span>zoom3]<span class="op">,</span></span>
<span id="cb12-424"><a href="#cb12-424" aria-hidden="true" tabindex="-1"></a>               [<span class="dv">3760524</span><span class="op">-</span>zoom3<span class="op">,</span> <span class="dv">3760524</span><span class="op">-</span>zoom4]]</span>
<span id="cb12-425"><a href="#cb12-425" aria-hidden="true" tabindex="-1"></a>x_max_range <span class="op">=</span>  [[<span class="dv">4322644</span><span class="op">,</span> <span class="dv">3760524</span><span class="op">+</span>zoom1]<span class="op">,</span> [<span class="dv">3760524</span><span class="op">+</span>zoom1<span class="op">,</span> <span class="dv">3760524</span><span class="op">+</span>zoom2]<span class="op">,</span> [<span class="dv">3760524</span><span class="op">+</span>zoom2<span class="op">,</span> <span class="dv">3760524</span><span class="op">+</span>zoom3]<span class="op">,</span></span>
<span id="cb12-426"><a href="#cb12-426" aria-hidden="true" tabindex="-1"></a>               [<span class="dv">3760524</span><span class="op">+</span>zoom3<span class="op">,</span> <span class="dv">3760524</span><span class="op">+</span>zoom4]]</span>
<span id="cb12-427"><a href="#cb12-427" aria-hidden="true" tabindex="-1"></a>y_min_range <span class="op">=</span> [[<span class="dv">2016044</span><span class="op">,</span> <span class="dv">2889128</span><span class="op">-</span>zoom1]<span class="op">,</span> [<span class="dv">2889128</span><span class="op">-</span>zoom1<span class="op">,</span> <span class="dv">2889128</span><span class="op">-</span>zoom2]<span class="op">,</span>  [<span class="dv">2889128</span><span class="op">-</span>zoom2<span class="op">,</span> <span class="dv">2889128</span><span class="op">-</span>zoom3]<span class="op">,</span></span>
<span id="cb12-428"><a href="#cb12-428" aria-hidden="true" tabindex="-1"></a>               [<span class="dv">2889128</span><span class="op">-</span>zoom3<span class="op">,</span> <span class="dv">2889128</span><span class="op">-</span>zoom4]]</span>
<span id="cb12-429"><a href="#cb12-429" aria-hidden="true" tabindex="-1"></a>y_max_range <span class="op">=</span> [[<span class="dv">3261111</span><span class="op">,</span> <span class="dv">2889128</span><span class="op">+</span>zoom1]<span class="op">,</span> [<span class="dv">2889128</span><span class="op">+</span>zoom1<span class="op">,</span> <span class="dv">2889128</span><span class="op">+</span>zoom2]<span class="op">,</span>  [<span class="dv">2889128</span><span class="op">+</span>zoom2<span class="op">,</span> <span class="dv">2889128</span><span class="op">+</span>zoom3]<span class="op">,</span></span>
<span id="cb12-430"><a href="#cb12-430" aria-hidden="true" tabindex="-1"></a>               [<span class="dv">2889128</span><span class="op">+</span>zoom3<span class="op">,</span> <span class="dv">2889128</span><span class="op">+</span>zoom4]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-12-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-12-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-12-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-12-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell hidden">
<div class="sourceCode cell-code hidden" id="cb13" data-startfrom="438" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 437;"><span id="cb13-438"><a href="#cb13-438" aria-hidden="true" tabindex="-1"></a>x_min_f <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb13-439"><a href="#cb13-439" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">domain</span>(seuil_range)</span>
<span id="cb13-440"><a href="#cb13-440" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">range</span>(x_min_range[etape])</span>
<span id="cb13-441"><a href="#cb13-441" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">clamp</span>(<span class="kw">true</span>)</span>
<span id="cb13-442"><a href="#cb13-442" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-443"><a href="#cb13-443" aria-hidden="true" tabindex="-1"></a>x_max_f <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb13-444"><a href="#cb13-444" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">domain</span>(seuil_range)</span>
<span id="cb13-445"><a href="#cb13-445" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">range</span>(x_max_range[etape])</span>
<span id="cb13-446"><a href="#cb13-446" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">clamp</span>(<span class="kw">true</span>)</span>
<span id="cb13-447"><a href="#cb13-447" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-448"><a href="#cb13-448" aria-hidden="true" tabindex="-1"></a>y_min_f <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb13-449"><a href="#cb13-449" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">domain</span>(seuil_range)</span>
<span id="cb13-450"><a href="#cb13-450" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">range</span>(y_min_range[etape])</span>
<span id="cb13-451"><a href="#cb13-451" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">clamp</span>(<span class="kw">true</span>)  </span>
<span id="cb13-452"><a href="#cb13-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-453"><a href="#cb13-453" aria-hidden="true" tabindex="-1"></a>y_max_f <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb13-454"><a href="#cb13-454" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">domain</span>(seuil_range)</span>
<span id="cb13-455"><a href="#cb13-455" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">range</span>(y_max_range[etape])</span>
<span id="cb13-456"><a href="#cb13-456" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">clamp</span>(<span class="kw">true</span>)</span>
<span id="cb13-457"><a href="#cb13-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-458"><a href="#cb13-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-459"><a href="#cb13-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-460"><a href="#cb13-460" aria-hidden="true" tabindex="-1"></a>x_min <span class="op">=</span> <span class="fu">x_min_f</span>(progression)</span>
<span id="cb13-461"><a href="#cb13-461" aria-hidden="true" tabindex="-1"></a>x_max <span class="op">=</span> <span class="fu">x_max_f</span>(progression)</span>
<span id="cb13-462"><a href="#cb13-462" aria-hidden="true" tabindex="-1"></a>y_min <span class="op">=</span> <span class="fu">y_min_f</span>(progression)</span>
<span id="cb13-463"><a href="#cb13-463" aria-hidden="true" tabindex="-1"></a>y_max <span class="op">=</span> <span class="fu">y_max_f</span>(progression)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-13-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-13-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-13-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-13-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-13-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-13-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-13-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-13-8" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell hidden">
<div class="sourceCode cell-code hidden" id="cb14" data-startfrom="470" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 469;"><span id="cb14-470"><a href="#cb14-470" aria-hidden="true" tabindex="-1"></a>toto <span class="op">=</span> {</span>
<span id="cb14-471"><a href="#cb14-471" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> {<span class="cf">return</span> <span class="fu">trans_x</span>(x_min) <span class="op">+</span> <span class="st">" "</span> <span class="op">+</span> <span class="fu">trans_y</span>(y_max)<span class="op">+</span> <span class="st">" "</span>  <span class="op">+</span> (<span class="fu">trans_x</span>(x_max) <span class="op">-</span> <span class="fu">trans_x</span>(x_min)) <span class="op">+</span> <span class="st">" "</span> <span class="op">+</span> (<span class="fu">trans_x</span>(x_max) <span class="op">-</span> <span class="fu">trans_x</span>(x_min))}</span>
<span id="cb14-472"><a href="#cb14-472" aria-hidden="true" tabindex="-1"></a><span class="cf">catch</span> {<span class="cf">return</span> <span class="fu">trans_x</span>(<span class="dv">3760524</span><span class="op">-</span>zoom4) <span class="op">+</span> <span class="st">" "</span> <span class="op">+</span> <span class="fu">trans_y</span>(<span class="dv">2889128</span><span class="op">+</span>zoom4)<span class="op">+</span> <span class="st">" "</span>  <span class="op">+</span> (<span class="fu">trans_x</span>(<span class="dv">3760524</span><span class="op">+</span>zoom4) <span class="op">-</span> <span class="fu">trans_x</span>(<span class="dv">3760524</span><span class="op">-</span>zoom4)) <span class="op">+</span> <span class="st">" "</span> <span class="op">+</span> (<span class="fu">trans_x</span>(<span class="dv">3760524</span><span class="op">+</span>zoom4) <span class="op">-</span> <span class="fu">trans_x</span>(<span class="dv">3760524</span><span class="op">-</span>zoom4))}</span>
<span id="cb14-473"><a href="#cb14-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-474"><a href="#cb14-474" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-14" data-nodetype="declaration">

</div>
</div>
</div>
</section>
<section id="further-reading" class="level2">
<h2 class="anchored" data-anchor-id="further-reading">Further reading</h2>
<p>We highly recommend the book <a href="https://www.wiley.com/en-us/Fractal+Geometry+in+Human+Geography+and+Planning-p-9781394306565">Fractal Geometry in Human Geography and Planning</a> coordinated by Cecile Tannier, for which I had the pleasure of writing a few chapters with Cecile my Doctoral Advisor.</p>
<p>For a more theoretical and mathematical approach, nothing beats the book <a href="https://www.wiley.com/en-kr/Fractal+Geometry%3A+Mathematical+Foundations+and+Applications%2C+3rd+Edition-p-9781119942399">Fractal Geometry: Mathematical Foundations and Applications</a></p>
</section>

</main>
<!-- /main column -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IndpZHRoaGVpZ2h0ID0gTWF0aC5taW4od2lkdGgsIHdpbmRvdy5pbm5lckhlaWdodClcblxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG5jaGFydCA9IFBsb3QucGxvdCh7XG4gIHByb2plY3Rpb246IHByb2plY3Rpb24sICBcblx0XG5cdHdpZHRoOiB3aWR0aGhlaWdodCxcblx0aGVpZ2h0OiB3aWR0aGhlaWdodCxcblxuICBjb2xvcjoge1xuICAgIHR5cGU6IFwicXVhbnRpbGVcIixcbiAgICBuOiA5LFxuICAgIHNjaGVtZTogXCJSZFlsR25cIixcbiAgICBsYWJlbDogXCJEZW5zaXR5IG9mIHBvcHVsYXRpb25cIixcbiAgICBsZWdlbmQ6IGZhbHNlLFxuICAgIHJldmVyc2U6IHRydWVcbiAgfSxcblxuICBtYXJrczogW1xuICAgIFBsb3QuZ2VvKGRhdGEsIHtmaWxsOiAoZCkgPT4gZC5wcm9wZXJ0aWVzLmluZH0pLFxuICAgIFBsb3QuZ2VvKGRlcCwgeyBzdHJva2U6IFwiYmxhY2tcIiwgc3Ryb2tlV2lkdGg6IDUwMDAvKDAuNStjclRyaWdnZXJJbmRleCoqMyAqLjUpIH0pLFxuXG4gICAgLCBudWxsXG4gIF1cbn0pXG5cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InRyYW5zX3ggPSBmdW5jdGlvbih4KSB7cmV0dXJuICh4LSAzMjM0MjQyKS8xMjAwMDAwKndpZHRofTtcbnRyYW5zX3kgPSBmdW5jdGlvbih5KSB7cmV0dXJuICgteSsyMDE2MDQ0KzEyMDAwMDApLzEyMDAwMDAqd2lkdGh9O1xuY2hhcnQuc2V0QXR0cmlidXRlKFwidmlld0JveFwiLCB0b3RvKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImNhcnJlYXV4XzEgPSBGaWxlQXR0YWNobWVudChcImltYWdlcy9jYXJyZWF1eF8yMDAwMC5nZW9qc29uXCIpLmpzb24oKTtcbmNhcnJlYXV4XzIgPSBGaWxlQXR0YWNobWVudChcImltYWdlcy9jYXJyZWF1eF81MDAwLmdlb2pzb25cIikuanNvbigpO1xuY2FycmVhdXhfMyA9IEZpbGVBdHRhY2htZW50KFwiaW1hZ2VzL2NhcnJlYXV4XzEwMDAuZ2VvanNvblwiKS5qc29uKCk7XG5jYXJyZWF1eF80ID0gRmlsZUF0dGFjaG1lbnQoXCJpbWFnZXMvY2FycmVhdXhfMjAwLmdlb2pzb25cIikuanNvbigpO1xuZGVwID0gRmlsZUF0dGFjaG1lbnQoXCJpbWFnZXMvZGVwLmdlb2pzb25cIikuanNvbigpO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicHJvamVjdGlvbiA9ICAgICBkMy5nZW9UcmFuc2Zvcm0oe3BvaW50OiBmdW5jdGlvbih4LCB5KSB7dGhpcy5zdHJlYW0ucG9pbnQoKHgtIDMyMzQyNDIpLzEyMDAwMDAqd2lkdGgsKC15KzIwMTYwNDQrMTIwMDAwMCkvMTIwMDAwMCp3aWR0aCk7ICB9XG59KVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicHJvZ3Jlc3Npb24gPSBcbntcbnRyeSB7cmV0dXJuICBjclByb2dyZXNzQmxvY2t9XG5jYXRjaCB7cmV0dXJuIDAuOTl9XG59XG5cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InNldWlsID0gWzAsIC4yNSwgLjUsIDAuNzUsICAxXVxuXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJldGFwZSA9IFxue1xudHJ5IHtyZXR1cm4gc2V1aWwuZmluZEluZGV4KG51bSA9PiBudW0gPiBwcm9ncmVzc2lvbiktMTt9XG5jYXRjaCB7cmV0dXJuIDN9XG59XG5cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImRhdGFfcmFuZ2UgPSBbY2FycmVhdXhfMSwgY2FycmVhdXhfMiwgY2FycmVhdXhfMywgY2FycmVhdXhfNF1cbmRhdGEgPSBkYXRhX3JhbmdlW2V0YXBlXVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InNldWlsX3JhbmdlID0gW3NldWlsW2V0YXBlXSwgc2V1aWxbZXRhcGUrMV1dXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTExIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiem9vbTEgPSAxMDAwMDBcbnpvb20yID0gMjAwMDBcbnpvb20zID0gNzAwMFxuem9vbTQgPSA3MDAwXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoieF9taW5fcmFuZ2UgPSBbWzMyMzQyNDIsIDM3NjA1MjQtem9vbTFdLCBbMzc2MDUyNC16b29tMSwgMzc2MDUyNC16b29tMl0sIFszNzYwNTI0LXpvb20yLCAzNzYwNTI0LXpvb20zXSxcbiAgICAgICAgICAgICAgIFszNzYwNTI0LXpvb20zLCAzNzYwNTI0LXpvb200XV1cbnhfbWF4X3JhbmdlID0gIFtbNDMyMjY0NCwgMzc2MDUyNCt6b29tMV0sIFszNzYwNTI0K3pvb20xLCAzNzYwNTI0K3pvb20yXSwgWzM3NjA1MjQrem9vbTIsIDM3NjA1MjQrem9vbTNdLFxuICAgICAgICAgICAgICAgWzM3NjA1MjQrem9vbTMsIDM3NjA1MjQrem9vbTRdXVxueV9taW5fcmFuZ2UgPSBbWzIwMTYwNDQsIDI4ODkxMjgtem9vbTFdLCBbMjg4OTEyOC16b29tMSwgMjg4OTEyOC16b29tMl0sICBbMjg4OTEyOC16b29tMiwgMjg4OTEyOC16b29tM10sXG4gICAgICAgICAgICAgICBbMjg4OTEyOC16b29tMywgMjg4OTEyOC16b29tNF1dXG55X21heF9yYW5nZSA9IFtbMzI2MTExMSwgMjg4OTEyOCt6b29tMV0sIFsyODg5MTI4K3pvb20xLCAyODg5MTI4K3pvb20yXSwgIFsyODg5MTI4K3pvb20yLCAyODg5MTI4K3pvb20zXSxcbiAgICAgICAgICAgICAgIFsyODg5MTI4K3pvb20zLCAyODg5MTI4K3pvb200XV0gICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgIFxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InhfbWluX2YgPSBkMy5zY2FsZUxpbmVhcigpXG4gIC5kb21haW4oc2V1aWxfcmFuZ2UpXG4gIC5yYW5nZSh4X21pbl9yYW5nZVtldGFwZV0pXG4gIC5jbGFtcCh0cnVlKVxuICBcbnhfbWF4X2YgPSBkMy5zY2FsZUxpbmVhcigpXG4gIC5kb21haW4oc2V1aWxfcmFuZ2UpXG4gIC5yYW5nZSh4X21heF9yYW5nZVtldGFwZV0pXG4gIC5jbGFtcCh0cnVlKVxuICBcbnlfbWluX2YgPSBkMy5zY2FsZUxpbmVhcigpXG4gIC5kb21haW4oc2V1aWxfcmFuZ2UpXG4gIC5yYW5nZSh5X21pbl9yYW5nZVtldGFwZV0pXG4gIC5jbGFtcCh0cnVlKSAgXG5cbnlfbWF4X2YgPSBkMy5zY2FsZUxpbmVhcigpXG4gIC5kb21haW4oc2V1aWxfcmFuZ2UpXG4gIC5yYW5nZSh5X21heF9yYW5nZVtldGFwZV0pXG4gIC5jbGFtcCh0cnVlKVxuXG5cblxueF9taW4gPSB4X21pbl9mKHByb2dyZXNzaW9uKVxueF9tYXggPSB4X21heF9mKHByb2dyZXNzaW9uKVxueV9taW4gPSB5X21pbl9mKHByb2dyZXNzaW9uKVxueV9tYXggPSB5X21heF9mKHByb2dyZXNzaW9uKVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxuXG50b3RvID0ge1xudHJ5IHtyZXR1cm4gdHJhbnNfeCh4X21pbikgKyBcIiBcIiArIHRyYW5zX3koeV9tYXgpKyBcIiBcIiAgKyAodHJhbnNfeCh4X21heCkgLSB0cmFuc194KHhfbWluKSkgKyBcIiBcIiArICh0cmFuc194KHhfbWF4KSAtIHRyYW5zX3goeF9taW4pKX1cbmNhdGNoIHtyZXR1cm4gdHJhbnNfeCgzNzYwNTI0LXpvb200KSArIFwiIFwiICsgdHJhbnNfeSgyODg5MTI4K3pvb200KSsgXCIgXCIgICsgKHRyYW5zX3goMzc2MDUyNCt6b29tNCkgLSB0cmFuc194KDM3NjA1MjQtem9vbTQpKSArIFwiIFwiICsgKHRyYW5zX3goMzc2MDUyNCt6b29tNCkgLSB0cmFuc194KDM3NjA1MjQtem9vbTQpKX1cblxufVxuXG5cblxuIn1dfQ==
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../..";
window._ojs.paths.runtimeToRoot = "../../..";
window._ojs.paths.docToRoot = "";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>